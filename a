-- SpareStack UI Library - ALL ISSUES FIXED
-- Smaller size, infinite scrolling cards, settings icons, proper toggle states

local SpareStackLib = {}
SpareStackLib.__index = SpareStackLib

local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")

function SpareStackLib:CreateWindow(title)
	local self = setmetatable({}, SpareStackLib)
	
	-- Main ScreenGui
	local Sparestack = Instance.new("ScreenGui")
	Sparestack.Name = "Spare stack"
	Sparestack.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
	Sparestack.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	Sparestack.ResetOnSpawn = false
	Sparestack.IgnoreGuiInset = true
	
	-- Background (SMALLER SIZE - 80% of original)
	local Background = Instance.new("ImageLabel")
	Background.Name = "Background"
	Background.Parent = Sparestack
	Background.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Background.BackgroundTransparency = 1.000
	Background.BorderSizePixel = 0
	Background.AnchorPoint = Vector2.new(0.5, 0.5)
	Background.Position = UDim2.new(0.5, 0, 0.5, 0)
	Background.Size = UDim2.new(0, 808, 0, 504) -- 80% of 1011x630
	Background.ZIndex = 0
	Background.Image = "rbxassetid://71105506054247"
	Background.ScaleType = Enum.ScaleType.Stretch
	
	-- Make draggable
	local dragging = false
	local dragInput, mousePos, framePos
	
	Background.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			mousePos = input.Position
			framePos = Background.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	
	Background.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)
	
	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - mousePos
			Background.Position = UDim2.new(
				framePos.X.Scale,
				framePos.X.Offset + delta.X,
				framePos.Y.Scale,
				framePos.Y.Offset + delta.Y
			)
		end
	end)
	
	local UIPadding = Instance.new("UIPadding")
	UIPadding.Parent = Background
	UIPadding.PaddingLeft = UDim.new(0, 8)
	
	-- Search Holder (INSIDE BACKGROUND)
	local SearchHolder = Instance.new("Frame")
	SearchHolder.Name = "SearchHolder"
	SearchHolder.Parent = Background
	SearchHolder.BackgroundTransparency = 1
	SearchHolder.Position = UDim2.new(0.252, 0, 0.019, 0)
	SearchHolder.Size = UDim2.new(0, 158, 0, 32)
	
	local Search = Instance.new("TextBox")
	Search.Name = "Search"
	Search.Parent = SearchHolder
	Search.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Search.BorderSizePixel = 0
	Search.Size = UDim2.new(1, 0, 1, 0)
	Search.Font = Enum.Font.GothamSemibold
	Search.PlaceholderText = "Search . . ."
	Search.Text = ""
	Search.TextColor3 = Color3.fromRGB(255, 255, 255)
	Search.TextSize = 12
	Search.TextXAlignment = Enum.TextXAlignment.Left
	Search.ClearTextOnFocus = false
	
	local SearchPadding = Instance.new("UIPadding")
	SearchPadding.Parent = Search
	SearchPadding.PaddingLeft = UDim.new(0, 12)
	
	local SearchCorner = Instance.new("UICorner")
	SearchCorner.CornerRadius = UDim.new(0, 3)
	SearchCorner.Parent = Search
	
	local SearchIcon = Instance.new("ImageLabel")
	SearchIcon.Parent = Search
	SearchIcon.BackgroundTransparency = 1
	SearchIcon.Position = UDim2.new(0.805, 0, 0.3, 0)
	SearchIcon.Size = UDim2.new(0, 12, 0, 12)
	SearchIcon.Image = "rbxassetid://105544331892424"
	
	-- Settings Button (INSIDE BACKGROUND)
	local Settings = Instance.new("TextButton")
	Settings.Name = "Settings"
	Settings.Parent = Background
	Settings.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Settings.BorderSizePixel = 0
	Settings.Position = UDim2.new(0.93, 0, 0.017, 0)
	Settings.Size = UDim2.new(0, 36, 0, 36)
	Settings.Text = ""
	
	local SettingsCorner = Instance.new("UICorner")
	SettingsCorner.CornerRadius = UDim.new(0, 3)
	SettingsCorner.Parent = Settings
	
	local SettingsImage = Instance.new("ImageButton")
	SettingsImage.Parent = Settings
	SettingsImage.BackgroundTransparency = 1
	SettingsImage.Position = UDim2.new(0.256, 0, 0.284, 0)
	SettingsImage.Size = UDim2.new(0, 16, 0, 16)
	SettingsImage.Image = "rbxassetid://70543102142774"
	
	-- Title Image (INSIDE BACKGROUND)
	local TitleImage = Instance.new("ImageLabel")
	TitleImage.Name = "Title"
	TitleImage.Parent = Background
	TitleImage.BackgroundTransparency = 1
	TitleImage.Position = UDim2.new(0.01, 0, 0.12, 0)
	TitleImage.Size = UDim2.new(0, 160, 0, 32)
	TitleImage.Image = "rbxassetid://117733299243150"
	
	-- Side Holder (INSIDE BACKGROUND)
	local SideHolder = Instance.new("ScrollingFrame")
	SideHolder.Name = "SideHolder"
	SideHolder.Parent = Background
	SideHolder.BackgroundTransparency = 1
	SideHolder.BorderSizePixel = 0
	SideHolder.Position = UDim2.new(0.01, 0, 0.18, 0)
	SideHolder.Size = UDim2.new(0, 160, 0, 392)
	SideHolder.ScrollBarThickness = 0
	SideHolder.CanvasSize = UDim2.new(0, 0, 0, 0)
	
	local SideLayout = Instance.new("UIListLayout")
	SideLayout.Parent = SideHolder
	SideLayout.SortOrder = Enum.SortOrder.LayoutOrder
	SideLayout.Padding = UDim.new(0, 5)
	
	SideLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		SideHolder.CanvasSize = UDim2.new(0, 0, 0, SideLayout.AbsoluteContentSize.Y + 10)
	end)
	
	-- Card Holder (INSIDE BACKGROUND - VERTICAL SCROLLING)
	local CardHolder = Instance.new("ScrollingFrame")
	CardHolder.Name = "CardHolder"
	CardHolder.Parent = Background
	CardHolder.Active = true
	CardHolder.BackgroundTransparency = 1
	CardHolder.BorderSizePixel = 0
	CardHolder.Position = UDim2.new(0.23, 0, 0.18, 0)
	CardHolder.Size = UDim2.new(0, 596, 0, 392)
	CardHolder.ScrollBarThickness = 7
	CardHolder.CanvasSize = UDim2.new(0, 0, 0, 0)
	CardHolder.ScrollingDirection = Enum.ScrollingDirection.Y
	
	local CardLayout = Instance.new("UIGridLayout")
	CardLayout.Parent = CardHolder
	CardLayout.SortOrder = Enum.SortOrder.LayoutOrder
	CardLayout.CellPadding = UDim2.new(0, 12, 0, 12)
	CardLayout.CellSize = UDim2.new(0, 285, 0, 360)
	CardLayout.FillDirection = Enum.FillDirection.Horizontal
	CardLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
	CardLayout.VerticalAlignment = Enum.VerticalAlignment.Top
	
	CardLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		CardHolder.CanvasSize = UDim2.new(0, 0, 0, CardLayout.AbsoluteContentSize.Y + 20)
	end)
	
	self.Gui = Sparestack
	self.Background = Background
	self.SideHolder = SideHolder
	self.CardHolder = CardHolder
	self.SearchBox = Search
	self.Cards = {}
	self.Tabs = {}
	self.Categories = {}
	self.CurrentTab = nil
	self.CategoryOrder = 0
	self.TabOrder = 0
	
	-- Search functionality
	Search:GetPropertyChangedSignal("Text"):Connect(function()
		self:FilterCards(Search.Text:lower())
	end)
	
	return self
end

-- Filter cards
function SpareStackLib:FilterCards(query)
	for _, card in pairs(self.Cards) do
		if query == "" then
			if card:GetAttribute("Tab") == self.CurrentTab then
				card.Visible = true
			end
		else
			local cardTitle = card:FindFirstChild("CardTitle")
			if cardTitle and string.find(cardTitle.Text:lower(), query) then
				if card:GetAttribute("Tab") == self.CurrentTab then
					card.Visible = true
				else
					card.Visible = false
				end
			else
				card.Visible = false
			end
		end
	end
end

-- Add Category
function SpareStackLib:AddCategory(categoryName)
	self.CategoryOrder = self.CategoryOrder + 1
	
	local CategoryFrame = Instance.new("Frame")
	CategoryFrame.Name = "Category_" .. categoryName
	CategoryFrame.Parent = self.SideHolder
	CategoryFrame.BackgroundTransparency = 1
	CategoryFrame.Size = UDim2.new(0, 160, 0, 25)
	CategoryFrame.LayoutOrder = self.CategoryOrder
	
	local CategoryText = Instance.new("TextLabel")
	CategoryText.Name = "CategoryText"
	CategoryText.Parent = CategoryFrame
	CategoryText.BackgroundTransparency = 1
	CategoryText.Size = UDim2.new(1, 0, 1, 0)
	CategoryText.Font = Enum.Font.GothamBold
	CategoryText.Text = categoryName
	CategoryText.TextColor3 = Color3.fromRGB(58, 58, 73)
	CategoryText.TextSize = 12
	CategoryText.TextXAlignment = Enum.TextXAlignment.Left
	
	self.Categories[categoryName] = {
		Frame = CategoryFrame,
		Tabs = {}
	}
	
	return {
		AddTab = function(_, tabName, tabImage)
			return self:AddTab(tabName, tabImage, categoryName)
		end
	}
end

-- Add Tab
function SpareStackLib:AddTab(tabName, tabImage, categoryName)
	self.TabOrder = self.TabOrder + 1
	
	local Tab = Instance.new("Frame")
	Tab.Name = "Tab_" .. tabName
	Tab.Parent = self.SideHolder
	Tab.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Tab.BackgroundTransparency = 1
	Tab.BorderSizePixel = 0
	Tab.Size = UDim2.new(0, 190, 0, 33)
	Tab.LayoutOrder = self.TabOrder
	
	local TabButton = Instance.new("TextButton")
	TabButton.Parent = Tab
	TabButton.BackgroundTransparency = 1
	TabButton.Size = UDim2.new(1, 0, 1, 0)
	TabButton.Text = ""
	TabButton.ZIndex = 2
	
	local TabText = Instance.new("TextLabel")
	TabText.Name = "TabText"
	TabText.Parent = Tab
	TabText.BackgroundTransparency = 1
	TabText.Position = UDim2.new(0.205, 0, 0, 0)
	TabText.Size = UDim2.new(0.795, 0, 1, 0)
	TabText.Font = Enum.Font.GothamBold
	TabText.Text = tabName
	TabText.TextColor3 = Color3.fromRGB(255, 255, 255)
	TabText.TextSize = 12
	TabText.TextXAlignment = Enum.TextXAlignment.Left
	
	local TabImage = Instance.new("ImageLabel")
	TabImage.Name = "TabImage"
	TabImage.Parent = Tab
	TabImage.BackgroundTransparency = 1
	TabImage.Position = UDim2.new(0.08, 0, 0.244, 0)
	TabImage.Size = UDim2.new(0, 16, 0, 16)
	TabImage.Image = tabImage or "rbxassetid://97584948400851"
	
	TabButton.MouseButton1Click:Connect(function()
		self:SwitchTab(tabName)
	end)
	
	self.Tabs[tabName] = {
		Frame = Tab,
		Category = categoryName,
		Cards = {}
	}
	
	if categoryName and self.Categories[categoryName] then
		table.insert(self.Categories[categoryName].Tabs, tabName)
	end
	
	if not self.CurrentTab then
		self:SwitchTab(tabName)
	end
	
	return tabName
end

-- Switch Tab
function SpareStackLib:SwitchTab(tabName)
	self.CurrentTab = tabName
	
	for name, tab in pairs(self.Tabs) do
		if name == tabName then
			tab.Frame.BackgroundTransparency = 0
			tab.Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
		else
			tab.Frame.BackgroundTransparency = 1
		end
	end
	
	for _, card in pairs(self.Cards) do
		if card:GetAttribute("Tab") == tabName then
			card.Visible = true
		else
			card.Visible = false
		end
	end
end

-- Create Card (NOW WITH SCROLLING FRAME FOR INFINITE ELEMENTS)
function SpareStackLib:CreateCard(cardTitle, tabName)
	local Card = Instance.new("Frame")
	Card.Name = "Card_" .. cardTitle
	Card.Parent = self.CardHolder
	Card.BackgroundTransparency = 1
	Card.BorderSizePixel = 0
	Card.Size = UDim2.new(0, 285, 0, 360)
	Card:SetAttribute("Tab", tabName)
	
	local CardIcon = Instance.new("ImageLabel")
	CardIcon.Name = "Icon"
	CardIcon.Parent = Card
	CardIcon.BackgroundTransparency = 1
	CardIcon.Position = UDim2.new(0.045, 0, 0.035, 0)
	CardIcon.Size = UDim2.new(0, 16, 0, 16)
	CardIcon.Image = "rbxassetid://97584948400851"
	
	local CardBackground = Instance.new("ImageLabel")
	CardBackground.Name = "Background"
	CardBackground.Parent = Card
	CardBackground.BackgroundTransparency = 1
	CardBackground.Position = UDim2.new(0, 0, 0.11, 0)
	CardBackground.Size = UDim2.new(1, 0, 0.89, 0)
	CardBackground.ZIndex = 0
	CardBackground.Image = "rbxassetid://79172856971491"
	CardBackground.ScaleType = Enum.ScaleType.Stretch
	
	local CardTitleLabel = Instance.new("TextLabel")
	CardTitleLabel.Name = "CardTitle"
	CardTitleLabel.Parent = Card
	CardTitleLabel.BackgroundTransparency = 1
	CardTitleLabel.Position = UDim2.new(0.129, 0, 0, 0)
	CardTitleLabel.Size = UDim2.new(0.87, 0, 0, 40)
	CardTitleLabel.Font = Enum.Font.GothamBold
	CardTitleLabel.Text = cardTitle
	CardTitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	CardTitleLabel.TextSize = 12
	CardTitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	
	local Placard = Instance.new("ImageLabel")
	Placard.Name = "Placard"
	Placard.Parent = Card
	Placard.BackgroundTransparency = 1
	Placard.Size = UDim2.new(1, 0, 0, 40)
	Placard.ZIndex = 0
	Placard.Image = "rbxassetid://91296368223791"
	Placard.ScaleType = Enum.ScaleType.Stretch
	
	-- SCROLLING FRAME FOR INFINITE ELEMENTS
	local ElementsHolder = Instance.new("ScrollingFrame")
	ElementsHolder.Name = "ElementsHolder"
	ElementsHolder.Parent = Card
	ElementsHolder.BackgroundTransparency = 1
	ElementsHolder.BorderSizePixel = 0
	ElementsHolder.Position = UDim2.new(0.045, 0, 0.12, 0)
	ElementsHolder.Size = UDim2.new(0.91, 0, 0.86, 0)
	ElementsHolder.ScrollBarThickness = 5
	ElementsHolder.CanvasSize = UDim2.new(0, 0, 0, 0)
	ElementsHolder.ScrollingDirection = Enum.ScrollingDirection.Y
	
	local ElementsLayout = Instance.new("UIListLayout")
	ElementsLayout.Parent = ElementsHolder
	ElementsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	ElementsLayout.Padding = UDim.new(0, 8)
	
	ElementsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		ElementsHolder.CanvasSize = UDim2.new(0, 0, 0, ElementsLayout.AbsoluteContentSize.Y + 10)
	end)
	
	table.insert(self.Cards, Card)
	if self.Tabs[tabName] then
		table.insert(self.Tabs[tabName].Cards, Card)
	end
	
	return {
		Card = Card,
		ElementsHolder = ElementsHolder,
		AddToggle = function(_, name, default, callback, settings)
			return self:AddToggle(ElementsHolder, name, default, callback, settings)
		end,
		AddSlider = function(_, name, min, max, default, callback)
			return self:AddSlider(ElementsHolder, name, min, max, default, callback)
		end,
		AddDropdown = function(_, name, options, default, callback)
			return self:AddDropdown(ElementsHolder, name, options, default, callback)
		end,
		AddButton = function(_, name, callback)
			return self:AddButton(ElementsHolder, name, callback)
		end,
	}
end

-- Add Toggle (FIXED - NOT BACKWARDS, WITH SETTINGS ICON)
function SpareStackLib:AddToggle(parent, name, default, callback, settings)
	callback = callback or function() end
	default = default or false
	settings = settings == nil and false or settings
	
	local Title = Instance.new("Frame")
	Title.Name = "Toggle_" .. name
	Title.Parent = parent
	Title.BackgroundTransparency = 1
	Title.Size = UDim2.new(1, 0, 0, 40)
	
	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Name = "TitleLabel"
	TitleLabel.Parent = Title
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Size = UDim2.new(0.7, 0, 1, 0)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.Text = name
	TitleLabel.TextColor3 = default and Color3.fromRGB(58, 58, 73) or Color3.fromRGB(255, 255, 255)
	TitleLabel.TextSize = 12
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	
	-- Settings Icon (optional)
	local SettingsIcon
	if settings then
		SettingsIcon = Instance.new("ImageButton")
		SettingsIcon.Name = "SettingsIcon"
		SettingsIcon.Parent = Title
		SettingsIcon.BackgroundTransparency = 1
		SettingsIcon.Position = UDim2.new(0.75, 0, 0.3, 0)
		SettingsIcon.Size = UDim2.new(0, 12, 0, 12)
		SettingsIcon.Image = "rbxassetid://70543102142774"
		SettingsIcon.ImageColor3 = Color3.fromRGB(46, 46, 66)
		
		SettingsIcon.MouseButton1Click:Connect(function()
			-- Will be used for settings menu later
			print("Settings clicked for:", name)
		end)
	end
	
	local Background_2 = Instance.new("TextButton")
	Background_2.Name = "Background"
	Background_2.Parent = Title
	Background_2.BackgroundColor3 = default and Color3.fromRGB(28, 48, 103) or Color3.fromRGB(21, 21, 28)
	Background_2.BorderSizePixel = 0
	Background_2.Position = UDim2.new(0.85, 0, 0.25, 0)
	Background_2.Size = UDim2.new(0, 28, 0, 16)
	Background_2.Text = ""
	
	local BgCorner = Instance.new("UICorner")
	BgCorner.CornerRadius = UDim.new(1, 0)
	BgCorner.Parent = Background_2
	
	local Orb = Instance.new("Frame")
	Orb.Name = "Orb"
	Orb.Parent = Background_2
	Orb.BackgroundColor3 = default and Color3.fromRGB(51, 105, 255) or Color3.fromRGB(37, 37, 57)
	Orb.BorderSizePixel = 0
	Orb.Position = default and UDim2.new(0, 15, 0.15, 0) or UDim2.new(0, 2, 0.15, 0)
	Orb.Size = UDim2.new(0, 11, 0, 11)
	
	local OrbCorner = Instance.new("UICorner")
	OrbCorner.CornerRadius = UDim.new(1, 0)
	OrbCorner.Parent = Orb
	
	local toggled = default
	local tweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
	
	local function toggle()
		toggled = not toggled
		
		TweenService:Create(Orb, tweenInfo, {
			Position = toggled and UDim2.new(0, 15, 0.15, 0) or UDim2.new(0, 2, 0.15, 0)
		}):Play()
		
		TweenService:Create(Background_2, tweenInfo, {
			BackgroundColor3 = toggled and Color3.fromRGB(28, 48, 103) or Color3.fromRGB(21, 21, 28)
		}):Play()
		
		TweenService:Create(Orb, tweenInfo, {
			BackgroundColor3 = toggled and Color3.fromRGB(51, 105, 255) or Color3.fromRGB(37, 37, 57)
		}):Play()
		
		TweenService:Create(TitleLabel, tweenInfo, {
			TextColor3 = toggled and Color3.fromRGB(58, 58, 73) or Color3.fromRGB(255, 255, 255)
		}):Play()
		
		callback(toggled)
	end
	
	Background_2.MouseButton1Click:Connect(toggle)
	
	return {
		Toggle = toggle,
		SetValue = function(value)
			if value ~= toggled then
				toggle()
			end
		end,
		GetValue = function() return toggled end
	}
end

-- Add Slider (FIXED KNOB AND VALUE POSITIONING)
function SpareStackLib:AddSlider(parent, name, min, max, default, callback)
	callback = callback or function() end
	min = min or 0
	max = max or 100
	default = default or 0
	
	local SliderFrame = Instance.new("Frame")
	SliderFrame.Name = "Slider_" .. name
	SliderFrame.Parent = parent
	SliderFrame.BackgroundTransparency = 1
	SliderFrame.Size = UDim2.new(1, 0, 0, 55)
	
	local Title = Instance.new("TextLabel")
	Title.Parent = SliderFrame
	Title.BackgroundTransparency = 1
	Title.Size = UDim2.new(0.6, 0, 0, 20)
	Title.Font = Enum.Font.GothamBold
	Title.Text = name
	Title.TextColor3 = Color3.fromRGB(255, 255, 255)
	Title.TextSize = 12
	Title.TextXAlignment = Enum.TextXAlignment.Left
	
	local ValueLabel = Instance.new("TextBox")
	ValueLabel.Parent = Title
	ValueLabel.BackgroundTransparency = 1
	ValueLabel.Position = UDim2.new(1.05, 0, 0, 0)
	ValueLabel.Size = UDim2.new(0, 50, 1, 0)
	ValueLabel.Font = Enum.Font.Gotham
	ValueLabel.Text = "0%"
	ValueLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	ValueLabel.TextSize = 12
	ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
	
	local Bar = Instance.new("Frame")
	Bar.Name = "Bar"
	Bar.Parent = SliderFrame
	Bar.BackgroundColor3 = Color3.fromRGB(21, 21, 27)
	Bar.BorderSizePixel = 0
	Bar.Position = UDim2.new(0, 0, 0, 30)
	Bar.Size = UDim2.new(1, 0, 0, 7)
	
	local BarCorner = Instance.new("UICorner")
	BarCorner.Parent = Bar
	
	local Fill = Instance.new("Frame")
	Fill.Name = "Fill"
	Fill.Parent = Bar
	Fill.BackgroundColor3 = Color3.fromRGB(51, 105, 255)
	Fill.BorderSizePixel = 0
	Fill.Size = UDim2.new(0, 0, 1, 0)
	
	local FillCorner = Instance.new("UICorner")
	FillCorner.Parent = Fill
	
	local Knob = Instance.new("TextButton")
	Knob.Parent = Bar
	Knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Knob.BorderSizePixel = 0
	Knob.AnchorPoint = Vector2.new(0.5, 0.5)
	Knob.Position = UDim2.new(0, 0, 0.5, 0)
	Knob.Size = UDim2.new(0, 17, 0, 9)
	Knob.ZIndex = 2
	Knob.Text = ""
	
	local KnobCorner = Instance.new("UICorner")
	KnobCorner.CornerRadius = UDim.new(1, 0)
	KnobCorner.Parent = Knob
	
	local dragging = false
	local currentValue = default
	
	local function updateSlider(mouseX)
		local barWidth = Bar.AbsoluteSize.X
		mouseX = math.clamp(mouseX, 0, barWidth)
		
		Knob.Position = UDim2.new(0, mouseX, 0.5, 0)
		Fill.Size = UDim2.new(0, mouseX, 1, 0)
		
		local percent = mouseX / barWidth
		local value = min + (percent * (max - min))
		currentValue = math.floor(value)
		ValueLabel.Text = currentValue .. (max == 100 and "%" or "")
		
		callback(currentValue)
	end
	
	Knob.MouseButton1Down:Connect(function()
		dragging = true
	end)
	
	UIS.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)
	
	UIS.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local mouseX = input.Position.X - Bar.AbsolutePosition.X
			updateSlider(mouseX)
		end
	end)
	
	Bar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			local mouseX = input.Position.X - Bar.AbsolutePosition.X
			updateSlider(mouseX)
		end
	end)
	
	ValueLabel.FocusLost:Connect(function()
		local value = tonumber(ValueLabel.Text:match("%d+"))
		if value then
			value = math.clamp(value, min, max)
			local percent = (value - min) / (max - min)
			updateSlider(percent * Bar.AbsoluteSize.X)
		end
	end)
	
	local initPercent = (default - min) / (max - min)
	task.wait()
	updateSlider(initPercent * Bar.AbsoluteSize.X)
	
	return {
		SetValue = function(val)
			task.wait()
			updateSlider(((val - min) / (max - min)) * Bar.AbsoluteSize.X)
		end,
		GetValue = function() return currentValue end
	}
end

-- Add Dropdown
function SpareStackLib:AddDropdown(parent, name, options, default, callback)
	callback = callback or function() end
	options = options or {"Option 1", "Option 2"}
	default = default or options[1]
	
	local DropdownFrame = Instance.new("Frame")
	DropdownFrame.Name = "Dropdown_" .. name
	DropdownFrame.Parent = parent
	DropdownFrame.BackgroundTransparency = 1
	DropdownFrame.Size = UDim2.new(1, 0, 0, 38)
	DropdownFrame.ClipsDescendants = false
	DropdownFrame.ZIndex = 5
	
	local Dropdown = Instance.new("TextButton")
	Dropdown.Name = "Button"
	Dropdown.Parent = DropdownFrame
	Dropdown.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Dropdown.BorderSizePixel = 0
	Dropdown.Size = UDim2.new(1, 0, 0, 29)
	Dropdown.Font = Enum.Font.Gotham
	Dropdown.Text = "  " .. default
	Dropdown.TextColor3 = Color3.fromRGB(255, 255, 255)
	Dropdown.TextSize = 12
	Dropdown.TextXAlignment = Enum.TextXAlignment.Left
	
	local DropdownCorner = Instance.new("UICorner")
	DropdownCorner.CornerRadius = UDim.new(0, 3)
	DropdownCorner.Parent = Dropdown
	
	local DropdownPadding = Instance.new("UIPadding")
	DropdownPadding.Parent = Dropdown
	DropdownPadding.PaddingLeft = UDim.new(0, 8)
	
	local Arrow = Instance.new("TextLabel")
	Arrow.Name = "Arrow"
	Arrow.Parent = Dropdown
	Arrow.BackgroundTransparency = 1
	Arrow.Position = UDim2.new(0.88, 0, 0.22, 0)
	Arrow.Size = UDim2.new(0, 16, 0, 16)
	Arrow.Font = Enum.Font.GothamBold
	Arrow.Text = "â–¼"
	Arrow.TextColor3 = Color3.fromRGB(255, 255, 255)
	Arrow.TextSize = 12
	
	local OptionsHolder = Instance.new("ScrollingFrame")
	OptionsHolder.Name = "Options"
	OptionsHolder.Parent = DropdownFrame
	OptionsHolder.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	OptionsHolder.BorderSizePixel = 0
	OptionsHolder.Position = UDim2.new(0, 0, 0, 33)
	OptionsHolder.Size = UDim2.new(1, 0, 0, 0)
	OptionsHolder.Visible = false
	OptionsHolder.ScrollBarThickness = 5
	OptionsHolder.ClipsDescendants = true
	OptionsHolder.ZIndex = 10
	
	local OptionsCorner = Instance.new("UICorner")
	OptionsCorner.CornerRadius = UDim.new(0, 3)
	OptionsCorner.Parent = OptionsHolder
	
	local OptionsList = Instance.new("UIListLayout")
	OptionsList.Parent = OptionsHolder
	OptionsList.SortOrder = Enum.SortOrder.LayoutOrder
	OptionsList.Padding = UDim.new(0, 4)
	
	local OptionsPadding = Instance.new("UIPadding")
	OptionsPadding.Parent = OptionsHolder
	OptionsPadding.PaddingLeft = UDim.new(0, 8)
	OptionsPadding.PaddingRight = UDim.new(0, 8)
	OptionsPadding.PaddingTop = UDim.new(0, 8)
	OptionsPadding.PaddingBottom = UDim.new(0, 8)
	
	local isOpen = false
	local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
	local selectedValue = default
	
	for i, optionText in ipairs(options) do
		local Option = Instance.new("TextButton")
		Option.Name = "Option_" .. i
		Option.Parent = OptionsHolder
		Option.BackgroundColor3 = Color3.fromRGB(27, 27, 36)
		Option.BackgroundTransparency = 1
		Option.BorderSizePixel = 0
		Option.Size = UDim2.new(1, -16, 0, 24)
		Option.Font = Enum.Font.Gotham
		Option.Text = "  " .. optionText
		Option.TextColor3 = Color3.fromRGB(255, 255, 255)
		Option.TextSize = 11
		Option.TextXAlignment = Enum.TextXAlignment.Left
		Option.ZIndex = 11
		
		local OptionCorner = Instance.new("UICorner")
		OptionCorner.CornerRadius = UDim.new(0, 3)
		OptionCorner.Parent = Option
		
		local OptionPadding = Instance.new("UIPadding")
		OptionPadding.Parent = Option
		OptionPadding.PaddingLeft = UDim.new(0, 8)
		
		Option.MouseButton1Click:Connect(function()
			Dropdown.Text = "  " .. optionText
			selectedValue = optionText
			callback(optionText)
			
			isOpen = false
			OptionsHolder.Visible = false
			TweenService:Create(OptionsHolder, tweenInfo, {Size = UDim2.new(1, 0, 0, 0)}):Play()
			TweenService:Create(Arrow, tweenInfo, {Rotation = 0}):Play()
		end)
		
		Option.MouseEnter:Connect(function()
			TweenService:Create(Option, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
		end)
		
		Option.MouseLeave:Connect(function()
			TweenService:Create(Option, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
		end)
	end
	
	local dropdownHeight = math.min(#options * 28 + 16, 120)
	
	Dropdown.MouseButton1Click:Connect(function()
		isOpen = not isOpen
		
		if isOpen then
			OptionsHolder.Visible = true
			OptionsHolder.CanvasSize = UDim2.new(0, 0, 0, #options * 28 + 16)
			TweenService:Create(OptionsHolder, tweenInfo, {Size = UDim2.new(1, 0, 0, dropdownHeight)}):Play()
			TweenService:Create(Arrow, tweenInfo, {Rotation = 180}):Play()
		else
			TweenService:Create(OptionsHolder, tweenInfo, {Size = UDim2.new(1, 0, 0, 0)}):Play()
			TweenService:Create(Arrow, tweenInfo, {Rotation = 0}):Play()
			task.wait(0.3)
			if not isOpen then
				OptionsHolder.Visible = false
			end
		end
	end)
	
	return {
		SetValue = function(val)
			Dropdown.Text = "  " .. val
			selectedValue = val
		end,
		GetValue = function() return selectedValue end
	}
end

-- Add Button
function SpareStackLib:AddButton(parent, name, callback)
	callback = callback or function() end
	
	local Button = Instance.new("TextButton")
	Button.Name = "Button_" .. name
	Button.Parent = parent
	Button.BackgroundColor3 = Color3.fromRGB(51, 105, 255)
	Button.BorderSizePixel = 0
	Button.Size = UDim2.new(1, 0, 0, 32)
	Button.Font = Enum.Font.GothamBold
	Button.Text = name
	Button.TextColor3 = Color3.fromRGB(255, 255, 255)
	Button.TextSize = 12
	
	local ButtonCorner = Instance.new("UICorner")
	ButtonCorner.CornerRadius = UDim.new(0, 5)
	ButtonCorner.Parent = Button
	
	Button.MouseButton1Click:Connect(function()
		callback()
		
		TweenService:Create(Button, TweenInfo.new(0.1), {
			BackgroundColor3 = Color3.fromRGB(41, 85, 200)
		}):Play()
		task.wait(0.1)
		TweenService:Create(Button, TweenInfo.new(0.1), {
			BackgroundColor3 = Color3.fromRGB(51, 105, 255)
		}):Play()
	end)
	
	return Button
end

-- Notify
function SpareStackLib:Notify(title, text, duration)
	duration = duration or 3
	
	local Notification = Instance.new("Frame")
	Notification.Name = "Notification"
	Notification.Parent = self.Gui
	Notification.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Notification.BorderSizePixel = 0
	Notification.Position = UDim2.new(0.5, -120, 1, 80)
	Notification.Size = UDim2.new(0, 240, 0, 64)
	Notification.AnchorPoint = Vector2.new(0.5, 1)
	
	local NotifCorner = Instance.new("UICorner")
	NotifCorner.CornerRadius = UDim.new(0, 5)
	NotifCorner.Parent = Notification
	
	local NotifTitle = Instance.new("TextLabel")
	NotifTitle.Parent = Notification
	NotifTitle.BackgroundTransparency = 1
	NotifTitle.Position = UDim2.new(0, 8, 0, 8)
	NotifTitle.Size = UDim2.new(1, -16, 0, 20)
	NotifTitle.Font = Enum.Font.GothamBold
	NotifTitle.Text = title
	NotifTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
	NotifTitle.TextSize = 14
	NotifTitle.TextXAlignment = Enum.TextXAlignment.Left
	
	local NotifText = Instance.new("TextLabel")
	NotifText.Parent = Notification
	NotifText.BackgroundTransparency = 1
	NotifText.Position = UDim2.new(0, 8, 0, 28)
	NotifText.Size = UDim2.new(1, -16, 1, -36)
	NotifText.Font = Enum.Font.Gotham
	NotifText.Text = text
	NotifText.TextColor3 = Color3.fromRGB(200, 200, 200)
	NotifText.TextSize = 12
	NotifText.TextXAlignment = Enum.TextXAlignment.Left
	NotifText.TextYAlignment = Enum.TextYAlignment.Top
	NotifText.TextWrapped = true
	
	TweenService:Create(Notification, TweenInfo.new(0.5), {
		Position = UDim2.new(0.5, -120, 1, -16)
	}):Play()
	
	task.wait(duration)
	
	TweenService:Create(Notification, TweenInfo.new(0.5), {
		Position = UDim2.new(0.5, -120, 1, 80)
	}):Play()
	
	task.wait(0.5)
	Notification:Destroy()
end

return SpareStackLib
